<?phpinclude_once("generic_class/class.menu.php");include_once("clases/class.datospropBSN.php");include_once("clases/class.datosprop.php");include_once("clases/class.propiedadBSN.php");include_once("clases/class.caracteristicaBSN.php");include_once("clases/class.auxiliaresPGDAO.php");include_once("inc/funciones.inc");class DatospropVW {	private $datosprop;	private $arrayForm;		public function __construct($_datosprop=0){		DatospropVW::creaDatosprop();		if($_datosprop instanceof Datosprop )	{			DatospropVW::seteaDatosprop($_datosprop);		}		if (is_numeric($_datosprop)){			if($_datosprop!=0){				DatospropVW::cargaDatosprop($_datosprop);			}		}	}	public function cargaDatosprop($_datosprop){		$datosprop=new DatospropBSN($_datosprop);		$this->seteaDatosprop($datosprop->getObjeto()); //datosprop());			}		public function getIdDatosprop(){		return $this->datosprop->getId_prop_carac();			}		protected function creaDatosprop(){		$this->datosprop=new datosprop();	}		protected function seteaDatosprop($_datosprop){		$this->datosprop=$_datosprop;		$datosprop=new DatospropBSN($_datosprop);		$this->arrayForm=$datosprop->getObjetoView();	}			public function cargaDatosDatosprop($id_prop){		$caracBSN = new CaracteristicaBSN();		$carac = new Caracteristica();		$auxiliar = new AuxiliaresPGDAO();		$datosProp2 = new Datosprop();		$propBSN = new PropiedadBSN($id_prop);		$propiedad = $propBSN->getObjeto();		$arrayCarac = $auxiliar->coleccionTipopropCarac($propiedad->getId_tipo_prop());		print "<form action='carga_datosprop.php' name='carga' id='carga' method='post' onSubmit='javascript: return ValidaDatosprop(this);'>\n";		$menu=new Menu();		$menu->dibujaMenu('carga','opcion');//		p.id_prop_carac,p.id_prop,p.id_carac,p.contenido,p.comentario,c.tipo,c.titulo,t.tipo_carac		print "<table width='780' align='center' bgcolor='#FFFFFF'>\n";				print "<tr><td class='cd_celda_titulo'>Carga de Caracteristicas</td></tr>\n";				print "<tr><td align='center'>";		print "<table width='700' align='center' bgcolor='#FFFFFF'>\n";		$tipoCarac='';		foreach ($arrayCarac as $elemCarac){			if($tipoCarac!=$elemCarac[1]){				print "<tr><td class='cd_celda_titulo' colspan='2'>".$elemCarac[1]."</td></tr>\n";				$tipoCarac=$elemCarac[1];			}			$caracBSN->cargaById($elemCarac[0]);			$carac=$caracBSN->getObjeto();						$datosProp2->setId_prop($id_prop);				$datosProp2->setId_carac($elemCarac['0']);						$datosPropBSN = new DatospropBSN();			$datosPropBSN->seteaBSN($datosProp2);			$arrayDatos=$datosPropBSN->cargaColeccionForm();			switch ($carac->getTipo()) {				case 'CheckBox':					$this->armaCheckbox($carac->getId_carac(),$carac->getTitulo(),$arrayDatos[0]['contenido'],$carac->getComentario(),$arrayDatos[0]['comentario']);											break;				case 'Lista':					$this->armaLista($carac->getId_carac(),$carac->getTitulo(),$carac->getLista(),$arrayDatos[0]['contenido']);					break;				case 'Numerico':					$this->armaNumerico($carac->getId_carac(),$carac->getTitulo(),$carac->getMaximo(),$carac->getComentario(),$arrayDatos[0]['contenido'],$arrayDatos[0]['comentario']);					break;				case 'Texto':					$this->armaTexto($carac->getId_carac(),$carac->getTitulo(),$arrayDatos[0]['contenido']);					break;			}		}				print "<input type='hidden' name='id_prop' id='id_prop' value='".$id_prop."'>\n";				print "<br>";		print "<tr><td colspan='3' align='center'><input class='campos' type='submit' value='Enviar'><br /><br /><span class='obligatorio'>Los campos marcados con &bull; son obligatorios</span></td></tr>\n</table>\n";		print "</td></tr>\n</table>\n";		print "</form>\n";	}	/* Arma una lista desplegable con los valores pasados en LISTA, dejando marcado como Seleccion el dato pasado en CONTENIDO*/		protected function armaLista($id_carac,$titulo,$lista,$contenido){		$array=split(';',$lista);		$campo='l_'.$id_carac;		print "<tr><td class='cd_celda_texto' width='130'>$titulo</td>";		print "<td width='550'>";		print "<select name='".$campo."' id='".$campo."' class='campos'>\n";		for ($pos=0;$pos<sizeof($array);$pos++){			print "<option value='".$array[$pos]."'";			if ($array[$pos]==$contenido){				print " SELECTED ";			}			print ">".$array[$pos]."</option>\n";		}		print "</select>\n";		print "</td></tr>\n";	}	/* Arma una campo de ingreso ( si maximo = 0) o una lista desplegable con valores numericos desde 1 hasta el MAXIMO, dejando Seleccionado el valor indicado en CONTENIDO   en el caso de estar indicado el ingreso de comentarios, habilita un campo de texto para el mismo.*/	protected function armaNumerico($id_carac,$titulo,$maximo,$comentario,$contenido,$contcoment){		print "<tr><td class='cd_celda_texto' width='130'>$titulo</td>";		print "<td width='550'>";		if($maximo>0){			$campo='n_'.$id_carac;			print "<select name='".$campo."' id='".$campo."' class='campos'>\n";			for ($pos=1;$pos<=$maximo;$pos++){				print "<option value='".$pos."'";				if ($pos==$contenido){					print " SELECTED ";				}				print ">".$pos."</option>\n";			}			print "</select>\n";		}else{			$campo='n_'.$id_carac;			$this->armaCampo($campo,$contenido);		}		if($comentario=='Si'){			$campo='com_'.$id_carac;			$this->armaCampo($campo,$contcoment);		}		print "</td></tr>\n";			}// Arma un campo de ingreso de tipo Texto	protected function armaCampo($campo,$contenido){		print "<input class='campos' type='text' name='$campo' id='$campo' value='".	$contenido ."' maxlength='200' size='40'>";	}	protected function armaCheckbox($id_carac,$titulo,$contenido,$comentario,$contcoment){		print "<tr><td class='cd_celda_texto' width='130'>$titulo</td>";		print "<td width='550'>";		$campo='c_'.$id_carac;		print "<input type='checkbox' id='".$campo."' name='".$campo."'";		if ($contenido=='on'){			print " checked ";		}		print ">\n";		if($comentario=='Si'){			$campo='com_'.$id_carac;			$this->armaCampo($campo,$contcoment);		}		print "</td></tr>\n";		}		protected function armaTexto($id_carac,$titulo,$contenido){		print "<tr><td class='cd_celda_texto' width='130'>$titulo</td>";		print "<td width='550'>";		$campo='t_'.$id_carac;		$this->armaCampo($campo,$contenido);		print "</td></tr>\n";	}	/** * Lee desde un formulario los datos cargados para el datosprop. * Los registra en un objeto del tipo datosprop datosprop de esta clase * */	public function leeDatosDatospropVW(){		$datosaux=new Datosprop();		$this->datosprop=array();//		$datosprop=new DatospropBSN();		$campos = array_keys($_POST);		foreach ($campos as $datos){			$tipo=substr($datos,0,1);//,strpos("_",$datos)-2);			$id_carac=substr($datos,2);//,strpos("_",$datos)-1);//			echo "Tipo: ".$tipo." Id: ".$id_carac." Valor:".$_POST[$datos];			$id_prop=$_POST['id_prop'];			if($tipo=='c' || $tipo=='l' || $tipo=='n' || $tipo=='t'){				$this->datosprop[$id_carac]=array('id_prop'=>$id_prop,'contenido'=>$_POST[$datos]);			}elseif($tipo=='com'){				$this->datosprop[$id_carac]['comentario']=$_POST[$datos];			}		}//		print_r($_POST);die();	}/**    OK * Muestra una tabla con los datos de los datosprops y una barra de herramientas o menu * conde se despliegan las opciones ingresables para cada item * */	public function vistaTablaDatosprop($id){				$prop=new PropiedadBSN($id);				$fila=0;		print "<span class='pg_titulo'>Listado de Caracteristicas de la propiedad de </span><br>\n";				print "<span class='pg_titulo'>".$prop->getObjeto()->getCalle()." ".$prop->getObjeto()->getNro()."</span><br><br>\n";				$menu=new Menu();		$menu->dibujaMenu('lista','opcion');		print "<form name='lista' method='POST' action='respondeMenu.php'>";		print "  <table class='cd_tabla' width='98%'>\n";				$evenBSN=new DatospropBSN($id);				$arrayEven=$evenBSN->cargaColeccionForm();		$caracant='';				if(sizeof($arrayEven)==0){			print "No existen datos para mostrar";		} else {			foreach ($arrayEven as $Even){				if(trim($caracant)!=trim($Even['tipo_carac'])){					$caracant=$Even['tipo_carac'];					print "    <tr>\n";					print "     <td class='cd_lista_titulo' colspan='3'>".$Even['tipo_carac']."</td>\n";					print "	  </tr>\n";				}								if($fila==0){					$fila=1;				} else {					$fila=0;				}				print "<tr>\n";				print "	 <td class='row".$fila."'>".$Even['titulo']."</td>\n";				print "	 <td class='row".$fila."'>".$this->muestraDato($Even['tipo'],$Even['contenido'])."</td>\n";				print "	 <td class='row".$fila."'>".$Even['comentario']."</td>\n";				print "	</tr>\n";			}		}				print "  </table>\n";		print "<input type='hidden' name='id_prop_carac' id='id_prop_carac' value=''>";		print "<input type='hidden' name='opcion' id='opcion' value=''>";		print "</form>";	}	protected function muestraDato($tipo,$contenido){		if ($var=="CheckBox"){			if($contenido=='on'){				$imagen='check.png';			}else{				$imagen='uncheck.png';			}			print "<img src='images/$imagen' border=0>\n";		}else{			print "$contenido\n";		}	}		public function grabaModificacion(){		$retorno=false;		$datosprop=new DatospropBSN($this->datosprop);		$retUPre=$datosprop->actualizaDB();		if ($retUPre){			echo "Se proceso la grabacion en forma correcta<br>";			$retorno=true;		} else {			echo "Fallo la grabación de los datos<br>";		}		return $retorno;	}	public function grabaDatosprop($id_prop){		$retorno=false;		$datosprop=new DatospropBSN();		$retIPre=$datosprop->grabaCaracteristica_Prop($id_prop,$this->datosprop);			if ($retIPre){				echo "Se proceso la grabacion en forma correcta<br>";				$retorno=true;			} else {				echo "Fallo la grabación de los datos<br>";			}//		} // Fin control de Duplicados		return $retorno;	}				} // fin clase?>