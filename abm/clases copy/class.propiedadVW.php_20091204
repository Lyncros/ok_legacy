<?phpinclude_once("generic_class/class.menu.php");include_once("clases/class.propiedadBSN.php");include_once("clases/class.propiedad.php");include_once("clases/class.tipo_propBSN.php");include_once ("clases/class.zonaBSN.php");include_once ("clases/class.localidadBSN.php");include_once("inc/funciones.inc");class PropiedadVW {	private $propiedad;	private $arrayForm;		public function __construct($_propiedad=0){		PropiedadVW::creaPropiedad();		if($_propiedad instanceof Propiedad )	{			PropiedadVW::seteaPropiedad($_propiedad);		}		if (is_numeric($_propiedad)){			if($_propiedad!=0){				PropiedadVW::cargaPropiedad($_propiedad);			}		}	}	public function cargaPropiedad($_propiedad){		$propiedad=new PropiedadBSN($_propiedad);		$this->seteaPropiedad($propiedad->getObjeto()); //propiedad());			}		public function getIdPropiedad(){		return $this->propiedad->getId_prop();			}		protected function creaPropiedad(){		$this->propiedad=new propiedad();	}		protected function seteaPropiedad($_propiedad){		$this->propiedad=$_propiedad;		$propiedad=new PropiedadBSN($_propiedad);		$this->arrayForm=$propiedad->getObjetoView();	}		public function cargaDatosPropiedad($id_cli=0){		$zonaBSN = new ZonaBSN ();		$locaBSN = new LocalidadBSN();		$tipo_propBSN=new Tipo_propBSN();				if($id_cli!=0){			$this->arrayForm['id_cliente']=$id_cli;		}				print "<script type='text/javascript' language='javascript'>\n";		print "function validaIntermediacion(){\n";		print "     if(document.forms.carga.intermediacion.value=='Exclusiva'){;\n";		print "			desactiva('trint');\n";		print "		}else{\n";		print "			activa('trint');\n";		print "		}\n";		print "}\n";		print "function validaOperacion(){\n";		print "     if(document.forms.carga.operacion.value=='Tasacion'){;\n";		print "			activa('troper');\n";		print "		}else{\n";		print "			desactiva('troper');\n";		print "		}\n";		print "}\n";		print "function activa(campo){\n";		print "     document.getElementById(campo).style.display='table-row';\n";		print "}\n";		print "function desactiva(campo){\n";		print "     document.getElementById(campo).style.display='none';\n";		print "}\n";		print "</script>\n";		print "<form action='carga_propiedad.php' name='carga' id='carga' method='post' onSubmit='javascript: return ValidaPropiedad(this);'>\n";		$menu=new Menu();		$menu->dibujaMenu('carga');		print "<table width='780' align='center' bgcolor='#FFFFFF'>\n";				print "<tr><td class='cd_celda_titulo'>Carga de Propiedades</td></tr>\n";				print "<tr><td align='center'>";		print "<table width='700' align='center' bgcolor='#FFFFFF'>\n";						print "<tr><td class='cd_celda_texto' width='130'>Provincia</td>";		print "<td width='550'>";		if($this->arrayForm['id_zona']==''){			$this->arrayForm['id_zona']=0;		}		if($this->arrayForm['id_loca']==''){			$this->arrayForm['id_loca']=0;		}		$zonaBSN = new ZonaBSN ();		$zonaBSN->comboZona($this->arrayForm['id_zona'],$this->arrayForm['id_loca'],2);		print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";				print "<tr><td class='cd_celda_texto' width='130'>Localidad</td>";		print "<td width='550'>";		print "<div id='localidad'>";		$loca = new Localidad();		$loca->setId_loca($this->arrayForm['id_loca']);		$loca->setId_zona($this->arrayForm['id_zona']);		$locaBSN = new LocalidadBSN($loca);		$locaBSN->comboLocalidad($this->arrayForm['id_loca'],$this->arrayForm['id_zona'],2);		print "</div>";		print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";				print "<tr><td class='cd_celda_texto' width='130'>Calle</td>";		print "<td width='550'><input class='campos' type='text' name='calle' id='calle' value='".	$this->arrayForm['calle'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Nro</td>";		print "<td width='550'><input class='campos' type='text' name='nro' id='nro' value='".	$this->arrayForm['nro'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Piso</td>";		print "<td width='550'><input class='campos' type='text' name='piso' id='piso' value='".	$this->arrayForm['piso'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Dpto</td>";		print "<td width='550'><input class='campos' type='text' name='dpto' id='dpto' value='".	$this->arrayForm['dpto'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Entre</td>";		print "<td width='550'><input class='campos' type='text' name='entre1' id='entre1' value='".	$this->arrayForm['entre1'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'> y </td>";		print "<td width='550'><input class='campos' type='text' name='entre2' id='entre2' value='".	$this->arrayForm['entre2'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'> Descripcion </td>";		print "<td width='550'><input class='campos' type='text' name='descripcion' id='descripcion' value='".	$this->arrayForm['descripcion'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Tipo de Propiedad</td>";		print "<td width='550'>";		$tipo_propBSN->comboTipoProp($this->arrayForm['id_tipo_prop'],2);		print "</td></tr>";		print "<tr><td class='cd_celda_texto' width='130'>Intermediacion</td>";		print "<td width='550'>";		armaIntermediacion($this->arrayForm['intermediacion']);		print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";				print "<tr id='trint' style='display:";		if($this->arrayForm['intermediacion']!='Exclusiva' && $this->arrayForm['intermediacion']!=''){			$verMax='table-row';		}else{			$verMax='none';		}		print "$verMax' width='780'><td class='cd_celda_texto' width='130'>Inmobiliaria</td>";		print "<td width='550'>";//		$inmobiliriaBSN->comboInmo($this->arrayForm['id_inmo']);		armaInmo($this->arrayForm['id_inmo']);		print "</td></tr>";		if ($this->arrayForm['id_prop']==0){			print "<tr><td class='cd_celda_texto' width='130'>Operacion</td>";			print "<td width='550'>";			armaTipoOperacion($this->arrayForm['operacion'],2);			print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";			print "<tr id='troper' style='display:";			if($this->arrayForm['operacion']=='Tasacion'){				$verMax='table-row';			}else{				$verMax='none';			}			print "$verMax' width='780'>";			print "<td class='cd_celda_texto' width='130'>Comentario</td>";			print "<td width='550'><input class='campos' type='text' name='comentario' id='comentario' value='".	$this->arrayForm['comentario'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		}		print "<tr><td class='cd_celda_texto' width='130'>Video</td>";		print "<td width='550'><input class='campos' type='text' name='video' id='video' value='".	$this->arrayForm['video'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";				print "<tr><td class='cd_celda_texto' width='130'>Latitud (ref googlemap)</td>";		print "<td width='550'><input class='campos' type='text' name='goglat' id='goglat' value='".	$this->arrayForm['goglat'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Longitud (ref googlemap)</td>";		print "<td width='550'><input class='campos' type='text' name='goglong' id='goglong' value='".	$this->arrayForm['goglong'] ."' maxlength='250' size='80'></td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";				print "<input type='hidden' name='id_prop' id='id_prop' value='".$this->arrayForm['id_prop'] ."'>\n";		print "<input type='hidden' name='id_cliente' id='id_cliente' value='".$this->arrayForm['id_cliente'] ."'>\n";				print "<br>";		print "<tr><td colspan='3' align='center'><input class='campos' type='submit' value='Enviar'><br /><br /><span class='obligatorio'>Los campos marcados con &bull; son obligatorios</span></td></tr>\n</table>\n";		print "</td></tr>\n</table>\n";		print "</form>\n";	}	/** * Lee desde un formulario los datos cargados para el propiedad. * Los registra en un objeto del tipo propiedad propiedad de esta clase * */	public function leeDatosPropiedadVW(){		$propiedad=new PropiedadBSN();		$this->propiedad=$propiedad->leeDatosForm($_POST);	}/**    OK * Muestra una tabla con los datos de los propiedads y una barra de herramientas o menu * conde se despliegan las opciones ingresables para cada item * */	public function vistaTablaPropiedad(){		$zona = new Zona ();		$zonaBSN = new ZonaBSN ();		$local = new Localidad();		$localaBSN = new LocalidadBSN();		$tipopropBSN = new Tipo_propBSN();		$tipo_propBSN = new Tipo_propBSN();		$fila=0;		print "<script type='text/javascript' language='javascript'>\n";		print "function envia(opcion,id){\n";		print "     document.forms.lista.id_prop.value=id;\n";		print "   	submitform(opcion);\n";		print "}\n";		print "function filtra(){\n";		print "   document.lista.action='lista_propiedad.php?i=';\n";		print "   document.forms.lista.fid_zona.value=document.forms.lista.aux_zona.value;\n";		print "   document.forms.lista.fid_loca.value=document.forms.lista.aux_loca.value;\n";		print "   document.forms.lista.fid_tipo_prop.value=document.forms.lista.aux_prop.value;\n";		print "   document.forms.lista.foperacion.value=document.forms.lista.aux_operacion.value;\n";//		print "alert(document.forms.lista.operacion.value);\n";		print "   document.lista.submit();\n";		print "}\n";		print "function limpiafiltro(){\n";		print "   document.lista.action='lista_propiedad.php?i=';\n";		print "   document.forms.lista.fid_zona.value=0;\n";		print "   document.forms.lista.fid_loca.value=0;\n";		print "   document.forms.lista.fid_tipo_prop.value=0;\n";		print "   document.forms.lista.foperacion.value=0;\n";		print "   document.lista.submit();\n";		print "}\n";		print "</script>\n";		print "<span class='pg_titulo'>Listado de Propiedades</span><br><br>\n";				print "<form name='lista' method='POST' action='respondeMenu.php'>";		$menu=new Menu();		$menu->dibujaMenu('lista');//		$menu->dibujaMenu('lista','opcion');// Filtro				print "  <table class='cd_tabla' width='98%'>\n";		print "    <tr>\n";		print "     <td colspan='3' class='cd_lista_titulo' style='text-align: left; padding-left: 10px;'>Filtrar por </td>";		print "	</tr>";		print "<tr><td class='cd_celda_texto' width='130'>Provincia</td>";		print "<td width='550'>";		if(isset($_POST['fid_zona']) && $_POST['fid_zona']!=0){			$aux_zona=$_POST['fid_zona'];		}else{			$aux_zona=0;					}		if(isset($_POST['fid_loca']) && $_POST['fid_loca']!=0){			$aux_loca=$_POST['fid_loca'];		}else{			$aux_loca=0;					}		if(isset($_POST['fid_tipo_prop']) && $_POST['fid_tipo_prop']!=0){			$aux_prop=$_POST['fid_tipo_prop'];		}else{			$aux_prop=0;					}		if(isset($_POST['foperacion']) && $_POST['foperacion']!=0){			$aux_operacion=$_POST['foperacion'];		}else{			$aux_operacion=0;					}				$zona1BSN = new ZonaBSN ();		$zona1BSN->comboZona($aux_zona,$aux_loca,1,'aux_zona','aux_loca');				print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";				print "<tr><td class='cd_celda_texto' width='130'>Localidad</td>";		print "<td width='550'>";		print "<div id='localidad'>";		$loca = new Localidad();		$loca->setId_loca($aux_loca);		$loca->setId_zona($aux_zona);		$locaBSN = new LocalidadBSN($loca);		$locaBSN->comboLocalidad($aux_loca,$aux_zona,1,'aux_loca');		print "</div>";		print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='cd_celda_texto' width='130'>Tipo de Propiedad</td>";		print "<td width='550'>";		$tipo_propBSN->comboTipoProp($aux_prop,1,'aux_prop');		print "</td></tr>";		print "<tr><td class='cd_celda_texto' width='130'>Operacion</td>";		print "<td width='550'>";		armaTipoOperacion($aux_operacion,1,'aux_operacion',0);				print "</td><td><span class='obligatorio'>&nbsp;&bull;</span></td></tr>\n";		print "<tr><td class='row'><input class='campos' type='button' onclick='javascript:filtra();' value='Enviar'></td>\n";		print "<td class='row'><input class='campos' type='button' onclick='javascript:limpiafiltro();' value='Limpiar Filtro'></td>\n";		print "</tr>\n";		print "</table>\n";		// Fin Filtro						print "  <table class='cd_tabla' width='98%'>\n";		print "    <tr>\n";		print "     <td class='cd_lista_titulo' colspan='6'>&nbsp;</td>\n";		print "     <td class='cd_lista_titulo'>Provincia</td>\n";		print "     <td class='cd_lista_titulo'>Localidad</td>\n";		print "     <td class='cd_lista_titulo'>Calle</td>\n";		print "     <td class='cd_lista_titulo'>Nro</td>\n";		print "     <td class='cd_lista_titulo'>Piso</td>\n";		print "     <td class='cd_lista_titulo'>Dpto</td>\n";		print "     <td class='cd_lista_titulo'>Tipo Prop.</td>\n";		print "     <td class='cd_lista_titulo'>Intermediacion</td>\n";		print "	  </tr>\n";		$evenBSN=new PropiedadBSN();//		$arrayEven=$evenBSN->cargaColeccionForm();		$arrayEven=$evenBSN->cargaColeccionFiltro($aux_zona,$aux_loca,$aux_prop,$aux_operacion);		if(sizeof($arrayEven)==0){			print "No existen datos para mostrar";		} else {			foreach ($arrayEven as $Even){				if($fila==0){					$fila=1;				} else {					$fila=0;				}				print "<tr>\n";				print "	 <td class='row".$fila."'>";				print "    <a href='javascript:envia(22,".$Even['id_prop'].");' border='0'>";				print "       <img src='images/building_edit.png' alt='Modificar' border=0></a></td>";				print "	 <td class='row".$fila."'>";				print "    <a href='javascript:envia(23,".$Even['id_prop'].");' border=0>";				print "       <img src='images/delete.png' alt='Borrar' border=0></a></td>";				print "	 <td class='row".$fila."'>";				print "    <a href='javascript:envia(24,".$Even['id_prop'].");' border=0>";				print "       <img src='images/map_add.png' alt='Caracteristicas' border=0></a>";				print "  </td>\n";				print "	 <td class='row".$fila."'>";				print "    <a href='javascript:envia(25,".$Even['id_prop'].");' border=0>";				print "       <img src='images/camara.png' alt='Fotografias' border=0></a>";				print "  </td>\n";				print "	 <td class='row".$fila."'>";				print "    <a href='javascript:envia(26,".$Even['id_prop'].");' border=0>";				print "       <img src='images/operacion.png' alt='Operacion' border=0></a>";				print "  </td>\n";				print "	 <td class='row".$fila."'>";				print "    <a href='javascript:envia(27,".$Even['id_prop'].");' border=0>";				print "       <img src='images/cartel.png' alt='Cartel' border=0></a>";				print "  </td>\n";				print "	 <td class='row".$fila."'>";				$zonaBSN->setId ( $Even ['id_zona'] );				$zonaBSN->cargaById( $Even['id_zona'] );				print $zonaBSN->getObjeto()->getNombre_zona();				print "</td>\n";				print "	 <td class='row".$fila."'>";				$localaBSN->setId($Even['id_loca']);				$localaBSN->cargaById( $Even['id_loca'] );				print $localaBSN->getObjeto()->getNombre_loca();				print "</td>\n";				print "	 <td class='row".$fila."'>".$Even['calle']."</td>\n";				print "	 <td class='row".$fila."'>".$Even['nro']."</td>\n";				print "	 <td class='row".$fila."'>".$Even['piso']."</td>\n";				print "	 <td class='row".$fila."'>".$Even['dpto']."</td>\n";				print "	 <td class='row".$fila."'>";				$tipopropBSN->setId($Even['id_tipo_prop']);				$tipopropBSN->cargaById($Even['id_tipo_prop']);				print $tipopropBSN->getObjeto()->getTipo_prop();				print "</td>\n";				print "	 <td class='row".$fila."'>".$Even['intermediacion']."</td>\n";				print "	</tr>\n";			}		}				print "  </table>\n";		print "<input type='hidden' name='id_prop' id='id_prop' value=''>";//		print "<input type='hidden' name='opcion' id='opcion' value=''>";		print "<input type='hidden' name='fid_tipo_prop' id='fid_tipo_prop' value=''>";		print "<input type='hidden' name='fid_zona' id='fid_zona' value=''>";		print "<input type='hidden' name='fid_loca' id='fid_loca' value=''>";		print "<input type='hidden' name='foperacion' id='foperacion' value=''>";		print "</form>";	}		public function grabaModificacion(){		$retorno=false;		$propiedad=new PropiedadBSN($this->propiedad);		$retUPre=$propiedad->actualizaDB();		if ($retUPre){			echo "Se proceso la grabacion en forma correcta<br>";			$retorno=true;		} else {			echo "Fallo la grabación de los datos<br>";		}		return $retorno;	}	public function grabaPropiedad(){		$retorno=false;		$propiedad=new PropiedadBSN($this->propiedad);//Control de Duplicidad de los datos cargados, si no hace falta comentar las lineas del if//		$existente=$propiedad->controlDuplicado($this->propiedad->getPropiedad());//		if($existente){//			echo "Ya existe un propiedad con ese Titulo";//		} else {			$retIPre=$propiedad->insertaDB();//			die();			if ($retIPre){				$this->propiedad->setId_prop($propiedad->buscaID());				echo "Se proceso la grabacion en forma correcta<br>";				$retorno=true;			} else {				echo "Fallo la grabación de los datos<br>";			}//		} // Fin control de Duplicados		return $retorno;	}			public function muestraDomicilio(){		$local = new Localidad();		$localaBSN = new LocalidadBSN();		$localaBSN->setId($this->arrayForm['id_loca']);		$localaBSN->cargaById( $this->arrayForm['id_loca'] );		print "<span class='pg_titulo'>Propiedad:".$this->arrayForm['calle']." ".$this->arrayForm['nro']." ".$this->arrayForm['piso']." ".$this->arrayForm['dpto']." - ";		print $localaBSN->getObjeto()->getNombre_loca();		print "</span><br><br>\n";	}	} // fin clase?>
